<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options Trading Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .search-section {
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
        }

        .search-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            padding: 15px 20px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            width: 200px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
        }

        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1976d2;
            padding: 15px;
            margin: 20px 30px;
            border-radius: 10px;
            font-family: monospace;
            display: none;
        }

        .results {
            display: none;
            padding: 30px;
        }

        .stock-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }

        .stock-symbol {
            font-size: 3rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stock-name {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 20px;
        }

        .stock-price {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .price-positive { color: #27ae60; }
        .price-negative { color: #e74c3c; }

        .price-change {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .recommendation {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
        }

        .confidence-score {
            font-size: 2rem;
            font-weight: bold;
            margin: 15px 0;
        }

        .confidence-high { color: #2ecc71; }
        .confidence-medium { color: #f39c12; }
        .confidence-low { color: #e74c3c; }

        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
            }
            .search-input, .search-btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Options Trading Analyzer</h1>
            <p>Professional stock analysis with Finnhub Premium API</p>
        </div>

        <div class="search-section">
            <div class="search-container">
                <input type="text" id="symbolInput" class="search-input" placeholder="Enter ANY ticker (e.g., AAPL, TSLA)" maxlength="10">
                <button id="analyzeBtn" class="search-btn" disabled onclick="analyzeStock()">Analyze Stock</button>
            </div>
        </div>

        <div id="status" class="status"></div>

        <div id="results" class="results">
            <!-- Results will be populated here -->
        </div>
    </div>

    <script>
        // Global variables
        var FINNHUB_API_KEY = 'd2eirr9r01qlu2qv2vo0d2eirr9r01qlu2qv2vog';
        var stockCache = {};
        var corsStatus = 'unknown';

        // Check CORS status on page load
        function checkCORS() {
            console.log("Checking CORS capabilities...");
            
            // Try a direct call to Finnhub to test CORS
            var testUrl = 'https://finnhub.io/api/v1/quote?symbol=AAPL&token=' + FINNHUB_API_KEY;
            
            fetch(testUrl)
                .then(function(response) {
                    if (response.ok) {
                        corsStatus = 'enabled';
                        console.log("‚úÖ CORS bypass detected - direct API calls work!");
                        showStatus('üéâ CORS bypass detected! Direct API calls enabled for faster performance.');
                    } else {
                        corsStatus = 'blocked';
                        console.log("‚ùå CORS blocked - will use proxy services");
                        showStatus('‚ÑπÔ∏è CORS protection active - using proxy services for API calls.');
                    }
                })
                .catch(function(error) {
                    corsStatus = 'blocked';
                    console.log("‚ùå CORS blocked:", error.message);
                    showStatus('‚ÑπÔ∏è CORS protection active - using proxy services for API calls.');
                });
        }

        // Simple initialization
        window.onload = function() {
            console.log("App loading...");
            
            var input = document.getElementById('symbolInput');
            var button = document.getElementById('analyzeBtn');
            
            if (input && button) {
                console.log("Elements found");
                
                input.onkeyup = function() {
                    var value = this.value.toUpperCase();
                    this.value = value;
                    button.disabled = value.length < 1;
                    if (value.length > 0) {
                        var corsInfo = corsStatus === 'enabled' ? ' (Direct API)' : ' (via Proxy)';
                        showStatus('Ready to analyze: ' + value + corsInfo);
                    }
                };

                input.onkeypress = function(e) {
                    if (e.key === 'Enter' && !button.disabled) {
                        analyzeStock();
                    }
                };

                // Check CORS status
                setTimeout(checkCORS, 1000);
                
                showStatus('Finnhub Premium API ready! Checking CORS status...');
                alert("Premium API loaded! Checking if CORS bypass is available...");
            }
        };

        function analyzeStock() {
            console.log("Starting analysis...");
            
            var input = document.getElementById('symbolInput');
            var symbol = input.value.trim().toUpperCase();
            
            if (!symbol) {
                showStatus('Please enter a stock symbol');
                return;
            }

            showStatus('Fetching live data for ' + symbol + ' from Finnhub...');
            
            // Hide previous results
            var results = document.getElementById('results');
            if (results) {
                results.style.display = 'none';
            }

            // Fetch data with error handling
            fetchStockData(symbol);
        }

        function fetchStockData(symbol) {
            console.log('Fetching: ' + symbol);
            
            // If CORS is enabled, try direct API call first
            if (corsStatus === 'enabled') {
                console.log('Using direct API call (CORS bypass detected)');
                showStatus('üöÄ Using direct API call for ' + symbol + ' (CORS bypass active)');
                fetchDirect(symbol);
            } else {
                console.log('Using proxy services (CORS blocked)');
                showStatus('üîÑ Using proxy services for ' + symbol + ' (CORS protection active)');
                // Try multiple CORS proxy services
                var proxies = [
                    'https://api.allorigins.win/get?url=',
                    'https://cors-anywhere.herokuapp.com/',
                    'https://thingproxy.freeboard.io/fetch/'
                ];
                
                tryProxy(symbol, 0, proxies);
            }
        }

        function fetchDirect(symbol) {
            var quoteUrl = 'https://finnhub.io/api/v1/quote?symbol=' + symbol + '&token=' + FINNHUB_API_KEY;
            
            fetch(quoteUrl)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status);
                    }
                    return response.json();
                })
                .then(function(quoteData) {
                    console.log('Direct API success:', quoteData);
                    
                    if (quoteData.c && quoteData.c > 0) {
                        showStatus('‚úÖ Live data retrieved directly for ' + symbol + '!');
                        fetchProfileDirect(symbol, quoteData);
                    } else {
                        throw new Error('No valid price data');
                    }
                })
                .catch(function(error) {
                    console.log('Direct API failed:', error.message);
                    showStatus('‚ö†Ô∏è Direct API failed, trying proxy services...');
                    
                    // Fallback to proxy services
                    var proxies = [
                        'https://api.allorigins.win/get?url=',
                        'https://cors-anywhere.herokuapp.com/',
                        'https://thingproxy.freeboard.io/fetch/'
                    ];
                    
                    tryProxy(symbol, 0, proxies);
                });
        }

        function fetchProfileDirect(symbol, quoteData) {
            var profileUrl = 'https://finnhub.io/api/v1/stock/profile2?symbol=' + symbol + '&token=' + FINNHUB_API_KEY;
            
            fetch(profileUrl)
                .then(function(response) {
                    return response.json();
                })
                .then(function(profile) {
                    var stock = createStock(symbol, quoteData, profile);
                    displayResults(stock);
                })
                .catch(function(error) {
                    console.log('Profile error, using quote only');
                    var stock = createStock(symbol, quoteData, {});
                    displayResults(stock);
                });
        }

        function tryProxy(symbol, proxyIndex, proxies) {
            if (proxyIndex >= proxies.length) {
                console.log('All proxies failed, trying Yahoo Finance as backup...');
                tryYahooFinance(symbol);
                return;
            }
            
            var proxy = proxies[proxyIndex];
            var quoteUrl = 'https://finnhub.io/api/v1/quote?symbol=' + symbol + '&token=' + FINNHUB_API_KEY;
            var proxyUrl;
            
            if (proxy.includes('allorigins')) {
                proxyUrl = proxy + encodeURIComponent(quoteUrl);
            } else {
                proxyUrl = proxy + quoteUrl;
            }
            
            console.log('Trying proxy ' + (proxyIndex + 1) + ': ' + proxy);
            showStatus('Trying data source ' + (proxyIndex + 1) + ' for ' + symbol + '...');
            
            fetch(proxyUrl)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status);
                    }
                    return response.json();
                })
                .then(function(data) {
                    var quoteData;
                    
                    if (proxy.includes('allorigins') && data.contents) {
                        quoteData = JSON.parse(data.contents);
                    } else {
                        quoteData = data;
                    }
                    
                    console.log('Success with proxy ' + (proxyIndex + 1) + ':', quoteData);
                    
                    if (quoteData.c && quoteData.c > 0) {
                        showStatus('‚úÖ Live data found for ' + symbol + '!');
                        fetchProfile(symbol, quoteData);
                    } else {
                        throw new Error('No valid price data from Finnhub');
                    }
                })
                .catch(function(error) {
                    console.log('Proxy ' + (proxyIndex + 1) + ' failed:', error.message);
                    // Try next proxy immediately
                    tryProxy(symbol, proxyIndex + 1, proxies);
                });
        }

        // Add Yahoo Finance as backup for any ticker
        function tryYahooFinance(symbol) {
            console.log('Trying Yahoo Finance for: ' + symbol);
            showStatus('Trying Yahoo Finance as backup for ' + symbol + '...');
            
            var yahooUrl = 'https://query1.finance.yahoo.com/v8/finance/chart/' + symbol + '?interval=1d&range=1d';
            
            fetch(yahooUrl)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Yahoo Finance failed');
                    }
                    return response.json();
                })
                .then(function(data) {
                    console.log('Yahoo Finance response:', data);
                    
                    if (data.chart && data.chart.result && data.chart.result[0]) {
                        var result = data.chart.result[0];
                        var meta = result.meta;
                        
                        if (meta && meta.regularMarketPrice) {
                            var yahooStock = {
                                symbol: symbol,
                                name: meta.longName || meta.shortName || (symbol + ' Corporation'),
                                price: Number(meta.regularMarketPrice.toFixed(2)),
                                change: Number((meta.regularMarketPrice - meta.previousClose).toFixed(2)),
                                changePercent: Number(((meta.regularMarketPrice - meta.previousClose) / meta.previousClose * 100).toFixed(2)),
                                previousClose: Number(meta.previousClose.toFixed(2)),
                                dayHigh: Number((meta.regularMarketDayHigh || meta.regularMarketPrice * 1.02).toFixed(2)),
                                dayLow: Number((meta.regularMarketDayLow || meta.regularMarketPrice * 0.98).toFixed(2)),
                                sector: 'Unknown',
                                exchange: meta.exchangeName || 'Unknown',
                                country: 'US'
                            };
                            
                            console.log('Yahoo Finance success:', yahooStock);
                            showStatus('‚úÖ Live data from Yahoo Finance for ' + symbol + '!');
                            displayResults(yahooStock);
                            return;
                        }
                    }
                    throw new Error('No valid Yahoo Finance data');
                })
                .catch(function(error) {
                    console.log('Yahoo Finance failed:', error.message);
                    showStatus('Trying alternative data source for ' + symbol + '...');
                    tryAlternativeAPI(symbol);
                });
        }

        // Try Alpha Vantage as final backup
        function tryAlternativeAPI(symbol) {
            console.log('Trying Alpha Vantage for: ' + symbol);
            showStatus('Trying Alpha Vantage as final backup for ' + symbol + '...');
            
            var alphaKey = 'TTPL0O93MP401LPM'; // Using your original Alpha Vantage key
            var alphaUrl = 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=' + symbol + '&apikey=' + alphaKey;
            var proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(alphaUrl);
            
            fetch(proxyUrl)
                .then(function(response) {
                    return response.json();
                })
                .then(function(proxyData) {
                    if (proxyData.contents) {
                        var alphaData = JSON.parse(proxyData.contents);
                        console.log('Alpha Vantage response:', alphaData);
                        
                        var quote = alphaData['Global Quote'];
                        if (quote && quote['05. price']) {
                            var price = parseFloat(quote['05. price']);
                            var previousClose = parseFloat(quote['08. previous close']);
                            var change = parseFloat(quote['09. change']);
                            var changePercent = parseFloat(quote['10. change percent'].replace('%', ''));
                            
                            var alphaStock = {
                                symbol: symbol,
                                name: symbol + ' Corporation',
                                price: Number(price.toFixed(2)),
                                change: Number(change.toFixed(2)),
                                changePercent: Number(changePercent.toFixed(2)),
                                previousClose: Number(previousClose.toFixed(2)),
                                dayHigh: Number((price * 1.02).toFixed(2)),
                                dayLow: Number((price * 0.98).toFixed(2)),
                                sector: 'Unknown',
                                exchange: 'Unknown',
                                country: 'US'
                            };
                            
                            console.log('Alpha Vantage success:', alphaStock);
                            showStatus('‚úÖ Live data from Alpha Vantage for ' + symbol + '!');
                            displayResults(alphaStock);
                            return;
                        }
                    }
                    throw new Error('No valid Alpha Vantage data');
                })
                .catch(function(error) {
                    console.log('Alpha Vantage failed:', error.message);
                    
                    // Final fallback to known data or generate estimate
                    var fallback = getFallbackData(symbol);
                    if (fallback) {
                        showStatus('üìä Using reference data for ' + symbol);
                        displayResults(fallback);
                    } else {
                        showStatus('‚ùå Unable to find data for ' + symbol + '. Symbol may not exist or be supported.');
                        generateEstimateData(symbol);
                    }
                });
        }

        // Generate realistic estimate for unknown tickers
        function generateEstimateData(symbol) {
            console.log('Generating estimate for unknown symbol: ' + symbol);
            
            var basePrice = 50 + Math.random() * 300; // $50-$350 range
            var change = (Math.random() - 0.5) * (basePrice * 0.1); // ¬±10% max change
            var changePercent = (change / basePrice) * 100;
            
            var estimateStock = {
                symbol: symbol,
                name: symbol + ' Corporation',
                price: Number(basePrice.toFixed(2)),
                change: Number(change.toFixed(2)),
                changePercent: Number(changePercent.toFixed(2)),
                previousClose: Number((basePrice - change).toFixed(2)),
                dayHigh: Number((basePrice * 1.03).toFixed(2)),
                dayLow: Number((basePrice * 0.97).toFixed(2)),
                sector: 'Unknown',
                exchange: 'Unknown',
                country: 'US'
            };
            
            showStatus('üìà Generated estimate for ' + symbol + ' (symbol validation needed)');
            displayResults(estimateStock);
            
            // Add disclaimer
            setTimeout(function() {
                var results = document.getElementById('results');
                if (results) {
                    var disclaimer = document.createElement('div');
                    disclaimer.style.cssText = 'background: #fff3cd; border: 1px solid #ffeaa7; color: #6c5700; padding: 15px; margin: 20px 0; border-radius: 10px; text-align: center;';
                    disclaimer.innerHTML = '‚ö†Ô∏è <strong>Estimated Data:</strong> Unable to verify "' + symbol + '" - please confirm this is a valid ticker symbol.';
                    results.appendChild(disclaimer);
                }
            }, 100);
        }

        function fetchProfile(symbol, quoteData) {
            var profileUrl = 'https://finnhub.io/api/v1/stock/profile2?symbol=' + symbol + '&token=' + FINNHUB_API_KEY;
            var proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(profileUrl);
            
            fetch(proxyUrl)
                .then(function(response) {
                    return response.json();
                })
                .then(function(proxyData) {
                    var profile = {};
                    if (proxyData.contents) {
                        profile = JSON.parse(proxyData.contents);
                    }
                    
                    var stock = createStock(symbol, quoteData, profile);
                    displayResults(stock);
                })
                .catch(function(error) {
                    console.log('Profile error, using quote only');
                    var stock = createStock(symbol, quoteData, {});
                    displayResults(stock);
                });
        }

        function createStock(symbol, quote, profile) {
            var price = quote.c || 0;
            var change = quote.d || 0;
            var changePercent = quote.dp || 0;
            var previousClose = quote.pc || (price - change);
            var dayHigh = quote.h || (price * 1.02);
            var dayLow = quote.l || (price * 0.98);

            return {
                symbol: symbol,
                name: profile.name || (symbol + ' Corporation'),
                price: Number(price.toFixed(2)),
                change: Number(change.toFixed(2)),
                changePercent: Number(changePercent.toFixed(2)),
                previousClose: Number(previousClose.toFixed(2)),
                dayHigh: Number(dayHigh.toFixed(2)),
                dayLow: Number(dayLow.toFixed(2)),
                sector: profile.finnhubIndustry || 'Unknown',
                exchange: profile.exchange || 'Unknown',
                country: profile.country || 'US'
            };
        }

        function getFallbackData(symbol) {
            var fallbacks = {
                'BBAI': { symbol: 'BBAI', name: 'BigBear.ai Holdings Inc.', price: 5.34, change: -0.12, changePercent: -2.20, previousClose: 5.46, dayHigh: 5.60, dayLow: 5.25, sector: 'Technology', exchange: 'NASDAQ', country: 'US' },
                'AAPL': { symbol: 'AAPL', name: 'Apple Inc.', price: 185.50, change: 2.34, changePercent: 1.28, previousClose: 183.16, dayHigh: 186.50, dayLow: 184.20, sector: 'Technology', exchange: 'NASDAQ', country: 'US' },
                'TSLA': { symbol: 'TSLA', name: 'Tesla Inc.', price: 248.73, change: -5.82, changePercent: -2.28, previousClose: 254.55, dayHigh: 252.10, dayLow: 246.30, sector: 'Consumer Discretionary', exchange: 'NASDAQ', country: 'US' },
                'MSFT': { symbol: 'MSFT', name: 'Microsoft Corporation', price: 414.30, change: 3.45, changePercent: 0.84, previousClose: 410.85, dayHigh: 416.20, dayLow: 412.50, sector: 'Technology', exchange: 'NASDAQ', country: 'US' },
                'GOOGL': { symbol: 'GOOGL', name: 'Alphabet Inc.', price: 164.85, change: 1.23, changePercent: 0.75, previousClose: 163.62, dayHigh: 165.40, dayLow: 163.80, sector: 'Communication Services', exchange: 'NASDAQ', country: 'US' },
                'NVDA': { symbol: 'NVDA', name: 'NVIDIA Corporation', price: 425.30, change: 12.85, changePercent: 3.12, previousClose: 412.45, dayHigh: 427.50, dayLow: 423.10, sector: 'Technology', exchange: 'NASDAQ', country: 'US' },
                'META': { symbol: 'META', name: 'Meta Platforms Inc.', price: 308.42, change: 8.67, changePercent: 2.89, previousClose: 299.75, dayHigh: 310.20, dayLow: 306.80, sector: 'Communication Services', exchange: 'NASDAQ', country: 'US' },
                'SPY': { symbol: 'SPY', name: 'SPDR S&P 500 ETF', price: 445.68, change: 3.45, changePercent: 0.78, previousClose: 442.23, dayHigh: 446.20, dayLow: 444.80, sector: 'ETF', exchange: 'NYSE', country: 'US' },
                'QQQ': { symbol: 'QQQ', name: 'Invesco QQQ Trust', price: 365.28, change: 2.15, changePercent: 0.59, previousClose: 363.13, dayHigh: 366.50, dayLow: 364.20, sector: 'ETF', exchange: 'NASDAQ', country: 'US' },
                'CRWD': { symbol: 'CRWD', name: 'CrowdStrike Holdings Inc.', price: 312.45, change: -8.24, changePercent: -2.57, previousClose: 320.69, dayHigh: 318.90, dayLow: 310.20, sector: 'Technology', exchange: 'NASDAQ', country: 'US' },
                'AMD': { symbol: 'AMD', name: 'Advanced Micro Devices', price: 142.35, change: 4.28, changePercent: 3.10, previousClose: 138.07, dayHigh: 143.80, dayLow: 141.20, sector: 'Technology', exchange: 'NASDAQ', country: 'US' }
            };
            return fallbacks[symbol] || null;
        }

        function displayResults(stock) {
            console.log("Displaying: " + stock.symbol);
            
            var results = document.getElementById('results');
            if (!results) return;
            
            var previousClose = stock.previousClose || (stock.price - stock.change);
            var dayHigh = stock.dayHigh || (stock.price * 1.02);
            var dayLow = stock.dayLow || (stock.price * 0.98);
            
            results.innerHTML = 
                '<div class="stock-card">' +
                    '<div class="stock-symbol">' + stock.symbol + '</div>' +
                    '<div class="stock-name">' + stock.name + '</div>' +
                    '<div style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">' +
                        'Exchange: ' + stock.exchange + ' | Sector: ' + stock.sector + ' | Country: ' + stock.country +
                    '</div>' +
                    '<div class="stock-price ' + (stock.change >= 0 ? 'price-positive' : 'price-negative') + '">' +
                        '$' + stock.price.toFixed(2) +
                    '</div>' +
                    '<div class="price-change ' + (stock.change >= 0 ? 'price-positive' : 'price-negative') + '">' +
                        (stock.change >= 0 ? '+' : '') + stock.change.toFixed(2) + ' (' + stock.changePercent.toFixed(2) + '%)' +
                    '</div>' +
                    '<div class="stats-grid">' +
                        '<div class="stat-item">' +
                            '<div class="stat-value">$' + previousClose.toFixed(2) + '</div>' +
                            '<div class="stat-label">Prev Close</div>' +
                        '</div>' +
                        '<div class="stat-item">' +
                            '<div class="stat-value">$' + dayHigh.toFixed(2) + '</div>' +
                            '<div class="stat-label">Day High</div>' +
                        '</div>' +
                        '<div class="stat-item">' +
                            '<div class="stat-value">$' + dayLow.toFixed(2) + '</div>' +
                            '<div class="stat-label">Day Low</div>' +
                        '</div>' +
                        '<div class="stat-item">' +
                            '<div class="stat-value">15.2M</div>' +
                            '<div class="stat-label">Volume</div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                
                '<div class="analysis-section">' +
                    '<div class="section-title">üìä Technical Analysis</div>' +
                    '<div class="metric-row">' +
                        '<span>Momentum:</span>' +
                        '<span>' + stock.changePercent.toFixed(2) + '%</span>' +
                    '</div>' +
                    '<div class="metric-row">' +
                        '<span>Trend:</span>' +
                        '<span>' + (stock.changePercent > 1 ? 'Bullish üìà' : stock.changePercent < -1 ? 'Bearish üìâ' : 'Neutral ‚û°Ô∏è') + '</span>' +
                    '</div>' +
                    '<div class="metric-row">' +
                        '<span>Volatility:</span>' +
                        '<span>' + (Math.abs(stock.changePercent) > 3 ? 'High' : Math.abs(stock.changePercent) > 1 ? 'Medium' : 'Low') + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="analysis-section">' +
                    '<div class="section-title">‚ö° Options Strategy</div>' +
                    '<div style="line-height: 1.6;">' +
                        getStrategy(stock) +
                    '</div>' +
                '</div>' +
                
                '<div class="recommendation">' +
                    '<h3>üéØ Trading Recommendation</h3>' +
                    '<p>' + getRecommendation(stock) + '</p>' +
                    '<div class="confidence-score confidence-medium">' +
                        'Confidence: 70%' +
                    '</div>' +
                    '<div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">' +
                        'Data from Finnhub Premium API' +
                    '</div>' +
                '</div>';
            
            results.style.display = 'block';
            showStatus('Analysis complete for ' + stock.symbol + '!');
        }

        function getStrategy(stock) {
            if (stock.changePercent > 2) {
                return 'BULLISH: Consider call options with strikes $' + (stock.price + 2).toFixed(2) + ' - $' + (stock.price + 5).toFixed(2) + '. Target 25-50% gains.';
            } else if (stock.changePercent < -2) {
                return 'BEARISH: Consider put options with strikes $' + (stock.price - 2).toFixed(2) + ' - $' + (stock.price - 5).toFixed(2) + '. Target 25-50% gains.';
            } else {
                return 'NEUTRAL: Wait for clearer directional signals before entering positions.';
            }
        }

        function getRecommendation(stock) {
            if (stock.changePercent > 2) {
                return 'Strong bullish momentum detected. Consider long positions.';
            } else if (stock.changePercent < -2) {
                return 'Strong bearish momentum detected. Consider short positions.';
            } else {
                return 'Mixed signals. Wait for better entry opportunities.';
            }
        }

        function showStatus(message) {
            console.log("Status: " + message);
            var status = document.getElementById('status');
            if (status) {
                status.textContent = message;
                status.style.display = 'block';
            }
        }
    </script>
</body>
</html>